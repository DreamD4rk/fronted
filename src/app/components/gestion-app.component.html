<navbar></navbar>

<div class="w-full flex justify-between items-center mb-3 mt-1 px-3">
  <!-- Título a la izquierda -->
    <div>
        <h3 class="text-lg font-semibold text-slate-800">{{ title }}</h3>
    </div>
    
<!-- Grupo botón + buscador, pegado a la derecha -->
<div class="flex items-center space-x-4 p-5">
<!-- Botón Crear Usuario -->
<button 
  class="rounded-md bg-slate-800 py-2 px-3
          text-sm text-white flex items-center justify-center gap-2 font-semibold
          transition-all shadow-md
            hover:bg-slate-700 
            hover:shadow-lg
            focus:bg-slate-700 
            focus:outline-none focus:ring-0
            active:bg-slate-700 disabled:opacity-50"
  (click)="openFormModal()"> 
  <svg class="w-6 h-6 text-gray-800 dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
  <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 7.757v8.486M7.757 12h8.486M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"/>
</svg>
  Crear Usuario
</button>

<!-- Buscador -->
    <div class="relative w-64">
            <div class="relative">
                <input
                class="bg-white w-full pr-11 h-10 pl-3 py-2 bg-transparent placeholder:text-slate-400 text-slate-700 text-sm border border-slate-200 rounded transition duration-200 ease focus:outline-none focus:border-slate-400 hover:border-slate-400 shadow-sm focus:shadow-md"
                placeholder="Buscar..."
            />
            <button
            class="absolute h-8 w-8 right-1 top-1 px-2 flex items-center justify-center bg-white rounded"
            type="button"
            >
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="3" stroke="currentColor" class="w-8 h-8 text-slate-600">
                <path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" />
            </svg>
            </button>
            </div>
        </div>
</div>
</div>

@if (showAlert) {
  <!-- Toast flotante -->
  <div
    class="fixed top-4 right-4 z-50 w-400 max-w-md bg-white border border-gray-200 rounded-xl shadow-lg pointer-events-auto"
    role="alert"
    tabindex="-1"
    aria-labelledby="toast-label"
  >
    <div class="flex p-6">
      <div class="shrink-0">
        <svg
          class="h-4 w-4 text-teal-500 mt-0.5"
          xmlns="http://www.w3.org/2000/svg"
          width="16"
          height="16"
          fill="currentColor"
          viewBox="0 0 16 16"
        >
          <!-- icono check -->
          <path
            d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 
               0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 
               0-1.06 1.06L6.97 11.03a.75.75 0 0 
               0 1.079-.02l3.992-4.99a.75.75 0 0 
               0-.01-1.05z"
          ></path>
        </svg>
      </div>
      <div class="ms-3">
        <p id="hs-toast-success-example-label" class="text-sm dark:text-neutral-700">
          Usuario “{{ lastUsername }}” {{ toastAction }}
        </p>
        <p id="toast-label" class="mt-1 text-sm text-gray-500">
          Se ha {{ toastAction }} exitosamente al usuario en el sistema
        </p>
      </div>
    </div>
  </div>
}


<div class="relative flex flex-col w-full h-full overflow-auto text-gray-700 bg-white shadow-md rounded-lg">
  <!-- Tabla -->
    <user 
    [users]="users"
    (usernameEventEmitter)="removeUser($event)" 
    (selectUserEventEmitter)="openFormModal($event)">
  </user>

  <!-- Paginación -->
  <div class="flex justify-between items-center px-4 py-3">
    <div class="text-sm text-slate-500">
      Página {{ currentPage + 1 }} de {{ totalPages }}
    </div>
    <div class="flex space-x-1">
      <button class="px-3 py-1 min-w-9 min-h-9 text-sm font-normal text-slate-500 bg-white border border-slate-200 rounded hover:bg-slate-50 hover:border-slate-400 transition duration-200 ease"
        [disabled]="currentPage === 0"
        (click)="goToPage(currentPage - 1)">
        Prev
      </button>
      @for (item of [].constructor(totalPages); track $index) {
        <button class="px-3 py-1 min-w-9 min-h-9 text-sm font-normal text-white bg-slate-800 border border-slate-800 rounded hover:bg-slate-600 hover:border-slate-600 transition duration-200 ease"
        [class.font-bold]="$index === currentPage"
        (click)="goToPage($index)">
          {{ $index + 1 }}
        </button>
      }
      <button class="px-3 py-1 min-w-9 min-h-9 text-sm font-normal text-slate-500 bg-white border border-slate-200 rounded hover:bg-slate-50 hover:border-slate-400 transition duration-200 ease"
        [disabled]="currentPage === totalPages - 1"
        (click)="goToPage(currentPage + 1)">
        Next
      </button>
    </div>
  </div>
</div>
<br>

<!-- Backdrop + Modal: por encima de todo -->
@if (isFormModalOpen) {
  <div class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50">
    <user-form
      [user]="userSelected"
      [isEditMode]="isEditMode"
      [apiErrors]="fieldErrors"
      (save)="handleSave($event)"
      (cancel)="closeFormModal()"
    ></user-form>
  </div>
}

@if (hasFieldErrors()) {
  <div
  class="fixed top-4 right-4 z-50 max-w-md w-96 bg-white border border-red-200 rounded-xl shadow-lg pointer-events-auto"
  role="alert">
  <div class="flex p-4">
    <svg class="h-10 w-10 text-red-500" fill="currentColor" viewBox="0 0 20 20">
      <path fill-rule="evenodd" d="M8.257 3.099c.763-1.36 2.723-1.36 3.486 0l6.516 11.63c.75
            1.339-.213 3.02-1.742 3.02H3.483c-1.53 0-2.492-1.681-1.742-3.02L8.257
            3.1zm1.743 10.401a1.25 1.25 0 1 0 0 2.5 1.25 1.25 0 0 0
            0-2.5zm-.75-6.25a.75.75 0 0 1 1.5 0v4a.75.75 0 0 1-1.5 0v-4z" clip-rule="evenodd" />
    </svg>
    <div class="ml-3">
      <p class="text-sm font-medium text-red-600">Recuerda que..</p>
      <ul class="mt-1 text-xs text-gray-700 list-disc list-inside space-y-2">
        @for (key of fieldErrorKeys(); track key) {
        <li>
          <span class="font-semibold">
            {{ fieldLabel(key) }}
          </span> {{ fieldErrors[key] }}
        </li>
        }
      </ul>
    </div>
  </div>
</div>
}



